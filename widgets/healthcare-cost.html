<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Cost by Income - Votecraft</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #5087e5;
            --primary-dark: #3a6bc7;
            --text: #32373c;
            --text-light: #666;
            --background: #f2f2f2;
            --border: #eaeaea;
            --white: #ffffff;
            --green: #10b981;
            --red: #ef4444;
            --red-dark: #b91c1c;
            --orange: #f59e0b;
            --purple: #8b5cf6;
            --yellow: #eab308;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Open Sans', Arial, sans-serif;
            color: var(--text);
            background: transparent;
            line-height: 1.6;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .healthcare-widget {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .widget-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .widget-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
        }

        .widget-subtitle {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .cost-demo {
            background: var(--white);
            border-radius: 12px;
            padding: 28px;
        }

        .cost-demo h4 {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
        }

        .income-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .income-btn {
            flex: 1;
            min-width: 80px;
            padding: 6px 6px;
            border: 2px solid var(--primary);
            background: var(--white);
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            color: var(--primary);
        }

        .income-btn:hover {
            background: var(--primary);
            color: white;
        }

        .income-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .income-btn.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: var(--background);
        }

        .income-btn.disabled:hover {
            border-color: var(--border);
        }

        .income-btn .income-label {
            display: block;
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 2px;
        }

        .income-btn .income-pct {
            display: block;
            font-size: 0.65rem;
            opacity: 0.7;
            margin-top: 3px;
            font-weight: 400;
        }

        .state-selector {
            margin-bottom: 16px;
        }

        .state-selector select {
            width: 100%;
            padding: 10px 12px;
            font-size: 0.9rem;
            font-family: inherit;
            border: 2px solid var(--primary);
            border-radius: 6px;
            background: var(--white);
            color: var(--primary);
            cursor: pointer;
            transition: border-color 0.2s;
            text-align: center;
        }

        .state-selector select:hover,
        .state-selector select:focus {
            border-color: var(--primary);
            outline: none;
        }

        .income-visual {
            background: rgba(80, 135, 229, 0.1);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .cost-comparison-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .cost-left-column {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .cost-breakdown-grid {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-height: 165px;
        }

        .income-bar-section {
            margin-top: 8px;
        }

        .system-comparison {
            display: flex;
            flex-direction: column;
            gap: 8px;
            height: 100%;
        }

        .system-comparison-header {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
            text-align: center;
        }

        .cost-breakdown-header {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
            text-align: center;
        }

        .cost-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background: var(--white);
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .cost-line.hidden-cost {
            background: rgba(139, 92, 246, 0.08);
            border: 1px dashed rgba(139, 92, 246, 0.3);
        }

        .cost-line.hidden-cost .cost-line-amount {
            color: var(--purple);
        }

        .hidden-tag {
            font-size: 0.7rem;
            background: var(--purple);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 6px;
            font-weight: 600;
        }

        .cost-line.total {
            background: var(--text);
            color: white;
            font-weight: 600;
            margin-top: 4px;
        }

        .cost-line.total .cost-line-amount {
            color: white;
            font-size: 1rem;
        }

        .cost-line-label {
            color: var(--text);
        }

        .cost-line.total .cost-line-label {
            color: white;
        }

        .cost-line-amount {
            font-weight: 600;
            color: var(--text);
        }

        .income-bar-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 6px;
        }

        .income-bar-label strong {
            color: var(--text);
        }

        .income-bar {
            height: 32px;
            background: var(--border);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .income-bar-fill {
            height: 100%;
            display: flex;
            transition: width 0.5s ease-out;
        }

        .income-bar-segment {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
            transition: width 0.5s ease-out;
        }

        .income-bar-segment.your-share {
            background: var(--red-dark);
        }

        .income-bar-segment.employer-share {
            background: var(--purple);
        }

        .income-bar-segment.oop-share {
            background: var(--red);
        }

        .income-bar-segment.remaining {
            background: var(--green);
        }

        .bar-legend {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            font-size: 0.75rem;
            margin-top: 8px;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text-light);
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }

        .legend-dot.your-share { background: var(--red-dark); }
        .legend-dot.employer-share { background: var(--purple); }
        .legend-dot.oop-share { background: var(--red); }
        .legend-dot.remaining { background: var(--green); }

        .bar-legend.empty .legend-dot {
            background: #ccc !important;
        }

        .income-compare-box {
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .info-icon {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 14px;
            height: 14px;
            background: rgba(255, 255, 255, 0.5);
            color: white;
            border-radius: 50%;
            font-size: 0.6rem;
            font-weight: 700;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: help;
            opacity: 0.6;
        }

        .info-icon:hover {
            opacity: 1;
        }

        .info-icon .tooltip {
            display: none;
            position: absolute;
            top: 20px;
            right: 0;
            width: 200px;
            padding: 8px 10px;
            background: var(--text);
            color: white;
            font-size: 0.75rem;
            font-style: normal;
            font-weight: 400;
            line-height: 1.4;
            border-radius: 6px;
            text-align: left;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .info-icon:hover .tooltip {
            display: block;
        }

        .income-compare-box.current {
            background: var(--red);
            border: 1px solid var(--red-dark);
        }

        .income-compare-box.universal {
            background: var(--primary);
            border: 1px solid var(--primary-dark);
        }

        .income-compare-label {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 4px;
            color: white;
            line-height: 1.3;
        }

        .income-compare-pct {
            font-size: 1rem;
            font-weight: 600;
            color: white;
        }

        .income-compare-detail {
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
            margin-top: 4px;
        }

        .income-impact {
            margin-top: 16px;
            padding: 14px;
            border-radius: 8px;
            font-size: 0.9rem;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .income-impact::before {
            flex-shrink: 0;
            font-size: 1.2rem;
            line-height: 1;
        }

        .income-impact.regressive {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: var(--text);
        }

        .income-impact.regressive::before {
            content: "⚠";
            color: var(--red);
        }

        .income-impact.regressive strong {
            color: var(--red);
        }

        .income-impact.medicaid {
            background: rgba(80, 135, 229, 0.1);
            border: 1px solid rgba(80, 135, 229, 0.2);
            color: var(--text);
        }

        .income-impact.medicaid::before {
            content: "";
            width: 24px;
            height: 24px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 -960 960 960' width='24px' fill='%235087e5'%3E%3Cpath d='M320-120v-200H120v-320h200v-200h320v200h200v320H640v200H320Zm80-80h160v-200h200v-160H560v-200H400v200H200v160h200v200Zm80-280Z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }

        .income-impact.medicaid strong {
            color: var(--primary);
        }

        .income-impact.affordable {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            color: var(--text);
        }

        .income-impact.affordable::before {
            content: "";
            width: 24px;
            height: 24px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 -960 960 960' width='24px' fill='%2322c55e'%3E%3Cpath d='M160-120q-33 0-56.5-23.5T80-200v-440q0-33 23.5-56.5T160-720h160v-80q0-33 23.5-56.5T400-880h160q33 0 56.5 23.5T640-800v80h160q33 0 56.5 23.5T880-640v440q0 33-23.5 56.5T800-120H160Zm240-600h160v-80H400v80Zm400 360H600v80H360v-80H160v160h640v-160Zm-360 0h80v-80h-80v80Zm-280-80h200v-80h240v80h200v-200H160v200Zm320 40Z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }

        .income-impact.affordable strong {
            color: var(--green);
        }

        .insight-content {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .insight-content strong {
            font-size: 1rem;
            display: block;
        }

        .insight-content p {
            margin: 0;
            line-height: 1.5;
        }

        .inline-source {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .inline-source a {
            color: var(--primary);
            text-decoration: none;
        }

        .inline-source a:hover {
            text-decoration: underline;
        }

        /* Grayed out state for results panels */
        .results-disabled {
            opacity: 0.4;
            pointer-events: none;
        }

        @media (max-width: 700px) {
            .cost-comparison-row {
                grid-template-columns: 1fr;
            }

            .system-comparison {
                flex-direction: row;
                gap: 12px;
            }

            .system-comparison .income-compare-box {
                flex: 1;
            }

            .income-bar-section {
                margin-top: 12px;
            }
        }

        @media (max-width: 600px) {
            body {
                padding: 12px;
            }

            .cost-demo {
                padding: 20px;
            }

            .widget-header h2 {
                font-size: 1.25rem;
            }

            .income-btn {
                min-width: 70px;
                padding: 8px 6px;
                font-size: 0.75rem;
            }

            .income-btn .income-pct {
                font-size: 0.6rem;
            }

            .income-comparison {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="healthcare-widget">
        <div class="widget-header">
            <h2>Healthcare Hits Different by Income</h2>
            <p class="widget-subtitle">See how much of your earnings go to healthcare based on income and employment type</p>
        </div>

        <div class="cost-demo">
            <h4>Your Income</h4>
            <div class="income-selector" id="income-selector">
                <button class="income-btn" data-income="0">
                    $0
                    <span class="income-pct">Unemployed</span>
                </button>
                <button class="income-btn" data-income="20000">
                    $10-30K
                    <span class="income-pct">21% of US</span>
                </button>
                <button class="income-btn" data-income="40000">
                    $30-50K
                    <span class="income-pct">18% of US</span>
                </button>
                <button class="income-btn" data-income="75000">
                    $50-100K
                    <span class="income-pct">24% of US</span>
                </button>
                <button class="income-btn" data-income="175000">
                    $100-250K
                    <span class="income-pct">28% of US</span>
                </button>
                <button class="income-btn" data-income="350000">
                    $250-450K+
                    <span class="income-pct">9% of US</span>
                </button>
            </div>

            <h4 style="margin-top: 16px;">Your Employment Type</h4>
            <div class="income-selector" id="employment-selector">
                <button class="income-btn" data-employment="minimum">
                    Min. Wage
                    <span class="income-label">Retail/Service</span>
                </button>
                <button class="income-btn" data-employment="gig">
                    Gig/Contract
                    <span class="income-label">1099 Worker</span>
                </button>
                <button class="income-btn" data-employment="parttime">
                    Part-Time
                    <span class="income-label">No Benefits</span>
                </button>
                <button class="income-btn" data-employment="fulltime">
                    Full-Time
                    <span class="income-label">W-2 + Benefits</span>
                </button>
            </div>

            <h4 style="margin-top: 16px;">Your State Type</h4>
            <div class="state-selector">
                <select id="state-select">
                    <option value="expansion">Medicaid Expansion State (41 states + DC)</option>
                    <option value="non-expansion">Non-Expansion State (TX, FL, GA, etc.)</option>
                </select>
            </div>

            <div class="income-visual">
                <div class="cost-comparison-row">
                    <div class="cost-left-column">
                        <div class="cost-breakdown-grid" id="cost-breakdown">
                            <div class="cost-breakdown-header">Annual Healthcare Costs</div>
                            <div class="cost-line hidden-cost" id="employer-row">
                                <span class="cost-line-label">Employer's Share <span class="hidden-tag">invisible to you</span></span>
                                <span class="cost-line-amount" id="cost-employer">—</span>
                            </div>
                            <div class="cost-line">
                                <span class="cost-line-label">Your Premium (paycheck deduction)</span>
                                <span class="cost-line-amount" id="cost-premium">—</span>
                            </div>
                            <div class="cost-line">
                                <span class="cost-line-label">Out-of-Pocket (deductibles, copays)</span>
                                <span class="cost-line-amount" id="cost-oop">—</span>
                            </div>
                            <div class="cost-line total">
                                <span class="cost-line-label">Total Healthcare Cost</span>
                                <span class="cost-line-amount" id="cost-total">—</span>
                            </div>
                        </div>

                        <div class="income-bar-section">
                            <div class="income-bar-label">
                                <span>Your Income: <strong id="income-amount">—</strong></span>
                                <span>Healthcare cost: <strong id="healthcare-pct-label">—</strong></span>
                            </div>
                            <div class="income-bar">
                                <div class="income-bar-fill">
                                    <div class="income-bar-segment employer-share" id="bar-employer-share" style="width: 0%"></div>
                                    <div class="income-bar-segment your-share" id="bar-your-share" style="width: 0%"></div>
                                    <div class="income-bar-segment oop-share" id="bar-oop-share" style="width: 0%"></div>
                                    <div class="income-bar-segment remaining" id="bar-remaining" style="width: 100%"></div>
                                </div>
                            </div>
                            <div class="bar-legend empty" id="bar-legend">
                                <span class="legend-item"><span class="legend-dot employer-share"></span> Employer's Share</span>
                                <span class="legend-item"><span class="legend-dot your-share"></span> Your Premium</span>
                                <span class="legend-item"><span class="legend-dot oop-share"></span> Out-of-Pocket</span>
                                <span class="legend-item"><span class="legend-dot remaining"></span> Remaining</span>
                            </div>
                        </div>
                    </div>

                    <div class="system-comparison">
                        <div class="system-comparison-header">Coverage %</div>
                        <div class="income-compare-box current">
                            <span class="info-icon">i<span class="tooltip">Total healthcare cost (premiums + out-of-pocket + employer share) as a percentage of your income. Data from KFF 2024.</span></span>
                            <div class="income-compare-label">Current System</div>
                            <div class="income-compare-pct" id="current-pct">???</div>
                            <div class="income-compare-detail" id="current-detail"></div>
                        </div>
                        <div class="income-compare-box universal">
                            <span class="info-icon">i<span class="tooltip">Based on an 8% income tax, a common rate in Medicare for All proposals to fund universal coverage.</span></span>
                            <div class="income-compare-label">Universal Basic Healthcare</div>
                            <div class="income-compare-pct" id="universal-pct">???</div>
                            <div class="income-compare-detail" id="universal-detail"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="income-impact regressive results-disabled" id="income-impact">
                <strong>Select your income and employment type above to see your healthcare cost breakdown.</strong>
            </div>
            <div class="inline-source" style="margin-top: 12px; text-align: center;">
                Sources: <a href="https://www.kff.org/health-costs/report/employer-health-benefits-annual-survey/" target="_blank">KFF 2024</a> ·
                <a href="https://www.bls.gov/cex/" target="_blank">BLS Consumer Expenditure</a>
            </div>
        </div>
    </div>

    <script>
        // DOM elements
        const employmentBtns = document.querySelectorAll('#employment-selector .income-btn');
        const incomeBtns = document.querySelectorAll('#income-selector .income-btn');
        const incomeAmount = document.getElementById('income-amount');
        const barYourShare = document.getElementById('bar-your-share');
        const barEmployerShare = document.getElementById('bar-employer-share');
        const barOopShare = document.getElementById('bar-oop-share');
        const barRemaining = document.getElementById('bar-remaining');
        const barLegend = document.getElementById('bar-legend');
        const currentPct = document.getElementById('current-pct');
        const currentDetail = document.getElementById('current-detail');
        const universalPct = document.getElementById('universal-pct');
        const universalDetail = document.getElementById('universal-detail');
        const incomeImpact = document.getElementById('income-impact');
        const costPremium = document.getElementById('cost-premium');
        const costEmployer = document.getElementById('cost-employer');
        const costOop = document.getElementById('cost-oop');
        const costTotal = document.getElementById('cost-total');
        const employerRow = document.getElementById('employer-row');
        const healthcarePctLabel = document.getElementById('healthcare-pct-label');
        const stateSelect = document.getElementById('state-select');

        // Current state - null means nothing selected yet
        let currentEmployment = null;
        let currentIncome = null;
        let currentState = 'expansion';

        // Employment type data
        const employmentData = {
            fulltime: {
                label: 'Full-Time W-2',
                employerPays: 17393,
                employeePays: 6575,
                outOfPocket: 3000,
                totalCost: 27000
            },
            parttime: {
                label: 'Part-Time (No Benefits)',
                employerPays: 0,
                employeePays: 15000,
                outOfPocket: 5000,
                totalCost: 20000
            },
            gig: {
                label: 'Gig/Contract (1099)',
                employerPays: 0,
                employeePays: 15000,
                outOfPocket: 5000,
                totalCost: 20000
            },
            minimum: {
                label: 'Minimum Wage (Retail/Service)',
                employerPays: 0,
                employeePays: 12000,
                outOfPocket: 4000,
                totalCost: 16000
            }
        };

        // Income labels
        const incomeLabels = {
            0: '$0 (Unemployed)',
            20000: '$10-30K (avg $20K)',
            40000: '$30-50K (avg $40K)',
            75000: '$50-100K (avg $75K)',
            175000: '$100-250K (avg $175K)',
            350000: '$250-450K+ (avg $350K)'
        };

        function getAdjustedCosts(employment, income, stateType) {
            const base = employmentData[employment];
            const medicaidEligible = income === 0 || (income <= 20000 && employment !== 'fulltime');

            if (stateType === 'expansion' && medicaidEligible) {
                return {
                    employerPays: 0,
                    employeePays: 0,
                    outOfPocket: 1500,
                    totalCost: 1500,
                    isMedicaid: true,
                    isCoverageGap: false
                };
            } else if (stateType === 'non-expansion' && medicaidEligible) {
                return {
                    employerPays: 0,
                    employeePays: 0,
                    outOfPocket: 12000,
                    totalCost: 12000,
                    isMedicaid: false,
                    isCoverageGap: true
                };
            }

            return {
                employerPays: base.employerPays,
                employeePays: base.employeePays,
                outOfPocket: base.outOfPocket,
                totalCost: base.totalCost,
                isMedicaid: false,
                isCoverageGap: false
            };
        }

        function getInsight(income, employment, adjustedCosts) {
            const pct = income > 0 ? Math.round((adjustedCosts.totalCost / income) * 100) : 0;

            // $0 income cases
            if (income === 0) {
                if (adjustedCosts.isMedicaid) {
                    return '<div class="insight-content"><strong>Medicaid safety net</strong><p>With no income, you likely qualify for Medicaid in expansion states (eligibility varies - some require disability, pregnancy, or dependent children). Coverage includes copays, prescriptions, and some dental/vision gaps averaging ~$1,500/year. This is what healthcare could look like for everyone under a universal system.</p></div>';
                } else if (adjustedCosts.isCoverageGap) {
                    return '<div class="insight-content"><strong>The coverage gap</strong><p>Even with $0 income, you may not qualify for Medicaid in non-expansion states (TX, FL, GA, WI, etc.). Without insurance, uninsured adults average $12K+ in annual medical costs when something goes wrong. About 2.2 million Americans are trapped in this gap.</p></div>';
                }
                return '<div class="insight-content"><strong>No income situation</strong><p>Without income, healthcare costs represent an infinite burden. This is why safety net programs exist.</p></div>';
            }

            // Medicaid/Coverage gap cases (low income, non-fulltime)
            if (adjustedCosts.isMedicaid) {
                return '<div class="insight-content"><strong>Medicaid safety net</strong><p>In expansion states, adults earning up to 138% FPL ($20,783/year) likely qualify for Medicaid (eligibility varies by household). Even with Medicaid, copays, prescriptions, and coverage gaps average ~$1,500/year. Still, this is what healthcare could look like for everyone under a universal 8% income-based system.</p></div>';
            }
            if (adjustedCosts.isCoverageGap) {
                return '<div class="insight-content"><strong>The coverage gap crisis</strong><p>In non-expansion states, you\'re trapped - too poor for ACA subsidies but don\'t qualify for Medicaid. Uninsured Americans average $12K+ in annual costs when medical issues arise. About 2.2 million Americans face this impossible situation.</p></div>';
            }

            // Full-time employment cases
            if (employment === 'fulltime') {
                if (income <= 30000) {
                    return '<div class="insight-content"><strong>Crushing burden</strong><p>Even with employer benefits, healthcare\'s TRUE cost ($27K including employer\'s hidden share) is ' + pct + '% of your income. That "hidden" employer contribution is money that could be your wages - the current system suppresses what you actually take home.</p></div>';
                } else if (income <= 100000) {
                    return '<div class="insight-content"><strong>The middle squeeze</strong><p>Healthcare takes ' + pct + '% of income when you count the employer\'s "hidden" contribution. That $17K your employer pays is part of YOUR compensation - money that could be higher wages under a different system.</p></div>';
                } else if (income <= 250000) {
                    return '<div class="insight-content"><strong>Getting easier</strong><p>Healthcare is ' + pct + '% of income - more manageable at this level. But you get the exact same coverage as someone paying 100%+ of their income. Same insurance, wildly different burden.</p></div>';
                } else {
                    return '<div class="insight-content"><strong>A lighter burden</strong><p>Healthcare is just ' + pct + '% of your income. Same insurance, same coverage as a family earning $30K who pays 90%. The current system is deeply regressive - a flat 8% income tax would be far more equitable.</p></div>';
                }
            }

            // Part-time and gig worker cases
            if (employment === 'parttime' || employment === 'gig') {
                if (income <= 30000) {
                    return '<div class="insight-content"><strong>Impossible choice</strong><p>With no employer benefits, healthcare costs $20K/year - that\'s ' + pct + '% of your income! Full-time W-2 workers get $17K in hidden employer support you don\'t. Many gig workers simply go uninsured.</p></div>';
                } else if (income <= 100000) {
                    return '<div class="insight-content"><strong>The gig penalty</strong><p>Without employer help, you pay $20K for healthcare (' + pct + '% of income). A full-time W-2 worker at your income only pays $9,575 directly - their employer covers $17K invisibly. That\'s a $17K/year penalty for non-traditional work.</p></div>';
                } else {
                    return '<div class="insight-content"><strong>The self-employment tax</strong><p>Even at higher incomes, no employer benefits means paying the FULL $20K yourself (' + pct + '% of income). This hidden $17K/year penalty punishes entrepreneurship and gig work.</p></div>';
                }
            }

            // Minimum wage cases
            if (currentState === 'non-expansion') {
                return '<div class="insight-content"><strong>The coverage gap</strong><p>In non-expansion states, minimum wage workers often can\'t afford coverage. You may be too poor for ACA subsidies but not qualify for Medicaid - trapped with no good options.</p></div>';
            }
            return '<div class="insight-content"><strong>The subsidy cliff</strong><p>ACA subsidies help at minimum wage, but out-of-pocket costs ($16K total) still consume ' + pct + '% of your income. A universal 8% system would cut your costs dramatically.</p></div>';
        }

        function updateDisplay() {
            // Get results section elements
            const incomeImpactDiv = document.getElementById('income-impact');

            // For $0 income, show results immediately (employment is irrelevant)
            // For other incomes, require both income AND employment selection
            const shouldShowResults = currentIncome === 0 || (currentIncome !== null && currentEmployment !== null);

            // Toggle grayed-out state for the insight text only
            if (!shouldShowResults) {
                incomeImpactDiv.classList.add('results-disabled');
                barLegend.classList.add('empty');
                return;
            }

            incomeImpactDiv.classList.remove('results-disabled');
            barLegend.classList.remove('empty');

            // For $0 income, use 'minimum' as default employment type (doesn't affect Medicaid calculation)
            const employmentForCalc = currentIncome === 0 ? 'minimum' : currentEmployment;
            const adjustedCosts = getAdjustedCosts(employmentForCalc, currentIncome, currentState);
            const universalTax = Math.round(currentIncome * 0.08);

            let currentPctVal, universalPctVal;
            if (currentIncome === 0) {
                currentPctVal = adjustedCosts.totalCost > 0 ? Infinity : 0;
                universalPctVal = 0;
            } else {
                currentPctVal = Math.round((adjustedCosts.totalCost / currentIncome) * 100);
                universalPctVal = Math.round((universalTax / currentIncome) * 100);
            }
            const savingsAmt = adjustedCosts.totalCost - universalTax;

            // Update cost breakdown
            costPremium.textContent = '$' + adjustedCosts.employeePays.toLocaleString() + '/yr';
            costOop.textContent = '$' + adjustedCosts.outOfPocket.toLocaleString() + '/yr';
            costTotal.textContent = '$' + adjustedCosts.totalCost.toLocaleString() + '/yr';

            if (adjustedCosts.employerPays > 0) {
                employerRow.style.display = 'flex';
                costEmployer.textContent = '$' + adjustedCosts.employerPays.toLocaleString() + '/yr';
            } else {
                employerRow.style.display = 'none';
            }

            incomeAmount.textContent = incomeLabels[currentIncome];
            if (currentIncome === 0) {
                healthcarePctLabel.textContent = adjustedCosts.totalCost > 0 ? 'N/A' : '0%';
            } else {
                healthcarePctLabel.textContent = currentPctVal > 100 ? '>100%' : currentPctVal + '%';
            }

            let yourSharePct, employerSharePct, oopSharePct, totalHealthcarePct, remainingPct;
            if (currentIncome === 0) {
                yourSharePct = adjustedCosts.employeePays > 0 ? 33 : 0;
                employerSharePct = adjustedCosts.employerPays > 0 ? 34 : 0;
                oopSharePct = adjustedCosts.outOfPocket > 0 ? 33 : 0;
                totalHealthcarePct = 100;
                remainingPct = 0;
            } else {
                yourSharePct = Math.min(Math.round((adjustedCosts.employeePays / currentIncome) * 100), 100);
                employerSharePct = Math.min(Math.round((adjustedCosts.employerPays / currentIncome) * 100), 100);
                oopSharePct = Math.min(Math.round((adjustedCosts.outOfPocket / currentIncome) * 100), 100);
                totalHealthcarePct = Math.min(yourSharePct + employerSharePct + oopSharePct, 100);
                remainingPct = Math.max(100 - totalHealthcarePct, 0);
            }

            barYourShare.style.width = yourSharePct + '%';
            barOopShare.style.width = oopSharePct + '%';
            barRemaining.style.width = remainingPct + '%';

            // Change oop-share color to yellow for Medicaid coverage
            const oopLegendItem = barLegend.querySelectorAll('.legend-item')[2];
            const oopLegendDot = oopLegendItem.querySelector('.legend-dot');
            if (adjustedCosts.isMedicaid) {
                barOopShare.style.background = 'var(--yellow)';
                oopLegendDot.style.background = 'var(--yellow)';
                oopLegendItem.innerHTML = '<span class="legend-dot oop-share" style="background: var(--yellow)"></span> Medicaid Coverage';
            } else {
                barOopShare.style.background = 'var(--red)';
                oopLegendDot.style.background = 'var(--red)';
                oopLegendItem.innerHTML = '<span class="legend-dot oop-share"></span> Out-of-Pocket';
            }

            if (adjustedCosts.employerPays > 0) {
                barEmployerShare.style.width = employerSharePct + '%';
                barEmployerShare.style.display = 'block';
            } else {
                barEmployerShare.style.width = '0%';
                barEmployerShare.style.display = 'none';
            }

            const employerLegendItem = barLegend.querySelectorAll('.legend-item')[0];
            if (adjustedCosts.employerPays > 0) {
                employerLegendItem.style.display = 'flex';
            } else {
                employerLegendItem.style.display = 'none';
            }

            if (currentIncome === 0) {
                currentPct.textContent = adjustedCosts.totalCost > 0 ? 'N/A' : '$0';
                universalPct.textContent = '$0';
            } else {
                currentPct.textContent = currentPctVal + '%';
                universalPct.textContent = universalPctVal + '%';
            }
            currentDetail.textContent = '$' + adjustedCosts.totalCost.toLocaleString() + '/year';

            if (currentIncome === 0) {
                universalDetail.textContent = '$0/year (no income = no tax)';
            } else if (savingsAmt > 0) {
                universalDetail.textContent = '$' + universalTax.toLocaleString() + '/year (save $' + savingsAmt.toLocaleString() + ')';
            } else if (savingsAmt < 0) {
                universalDetail.textContent = '$' + universalTax.toLocaleString() + '/year';
            } else {
                universalDetail.textContent = '$' + universalTax.toLocaleString() + '/year (same cost)';
            }

            incomeImpact.innerHTML = getInsight(currentIncome, currentEmployment, adjustedCosts);

            // Toggle box color based on situation
            incomeImpactDiv.classList.remove('regressive', 'medicaid', 'affordable');
            if (adjustedCosts.isMedicaid) {
                incomeImpactDiv.classList.add('medicaid');
            } else if (currentEmployment === 'fulltime' && currentIncome > 100000) {
                // "Getting easier" and "A lighter burden" cases
                incomeImpactDiv.classList.add('affordable');
            } else {
                incomeImpactDiv.classList.add('regressive');
            }
        }

        function updateEmploymentAvailability() {
            if (currentIncome === null) {
                // No income selected yet, disable employment
                employmentBtns.forEach(btn => {
                    btn.classList.add('disabled');
                    btn.disabled = true;
                });
            } else if (currentIncome === 0) {
                employmentBtns.forEach(btn => {
                    btn.classList.add('disabled');
                    btn.disabled = true;
                });
            } else {
                employmentBtns.forEach(btn => {
                    btn.classList.remove('disabled');
                    btn.disabled = false;
                });
            }
        }

        function updateStateAvailability() {
            // For $0 income, state is always relevant (Medicaid check)
            // For other incomes, require employment selection first
            if (currentIncome === null) {
                stateSelect.disabled = true;
                stateSelect.style.opacity = '0.4';
                stateSelect.style.cursor = 'not-allowed';
                return;
            }

            // $0 income always qualifies for Medicaid check
            if (currentIncome === 0) {
                stateSelect.disabled = false;
                stateSelect.style.opacity = '1';
                stateSelect.style.cursor = 'pointer';
                return;
            }

            // For other incomes, require employment selection
            if (currentEmployment === null) {
                stateSelect.disabled = true;
                stateSelect.style.opacity = '0.4';
                stateSelect.style.cursor = 'not-allowed';
                return;
            }

            const medicaidRelevant = currentIncome <= 20000 && currentEmployment !== 'fulltime';

            if (medicaidRelevant) {
                stateSelect.disabled = false;
                stateSelect.style.opacity = '1';
                stateSelect.style.cursor = 'pointer';
            } else {
                stateSelect.disabled = true;
                stateSelect.style.opacity = '0.4';
                stateSelect.style.cursor = 'not-allowed';
            }
        }

        function updateIncomeAvailability() {
            incomeBtns.forEach(btn => {
                btn.classList.remove('disabled');
                btn.disabled = false;
            });
        }

        // Event handlers
        employmentBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                if (this.disabled) return;
                employmentBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentEmployment = this.dataset.employment;
                updateIncomeAvailability();
                updateStateAvailability();
                updateDisplay();
            });
        });

        incomeBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                if (this.disabled) return;
                incomeBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentIncome = parseInt(this.dataset.income);

                updateEmploymentAvailability();
                updateStateAvailability();
                updateDisplay();
            });
        });

        stateSelect.addEventListener('change', function() {
            currentState = this.value;
            updateDisplay();
        });

        // Initialize
        updateIncomeAvailability();
        updateStateAvailability();
        updateDisplay();
    </script>
</body>
</html>
