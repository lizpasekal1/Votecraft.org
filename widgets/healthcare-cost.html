<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Cost by Income - Votecraft</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #5087e5;
            --primary-dark: #3a6bc7;
            --text: #32373c;
            --text-light: #666;
            --background: #ebebeb;
            --border: #eaeaea;
            --white: #ffffff;
            --green: #10b981;
            --red: #ef4444;
            --red-dark: #b91c1c;
            --orange: #f59e0b;
            --purple: #8b5cf6;
            --yellow: #eab308;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Open Sans', Arial, sans-serif;
            color: var(--text);
            background: transparent;
            line-height: 1.6;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .healthcare-widget {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .widget-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .widget-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
        }

        .widget-subtitle {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .cost-demo {
            background: var(--white);
            border-radius: 12px;
            padding: 28px;
        }

        .cost-demo h4 {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
        }

        .income-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .income-btn {
            flex: 1;
            min-width: 80px;
            padding: 6px 6px;
            border: 2px solid var(--border);
            background: var(--white);
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .income-btn:hover {
            border-color: var(--primary);
        }

        .income-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .income-btn.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: var(--background);
        }

        .income-btn.disabled:hover {
            border-color: var(--border);
        }

        .income-btn .income-label {
            display: block;
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 2px;
        }

        .income-btn .income-pct {
            display: block;
            font-size: 0.65rem;
            opacity: 0.7;
            margin-top: 3px;
            font-weight: 400;
        }

        .state-selector {
            margin-bottom: 16px;
        }

        .state-selector select {
            width: 100%;
            padding: 10px 12px;
            font-size: 0.9rem;
            font-family: inherit;
            border: 2px solid var(--border);
            border-radius: 6px;
            background: var(--white);
            color: var(--text);
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .state-selector select:hover,
        .state-selector select:focus {
            border-color: var(--primary);
            outline: none;
        }

        .income-visual {
            background: var(--background);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .cost-breakdown-grid {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 16px;
        }

        .cost-breakdown-header {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .cost-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background: var(--white);
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .cost-line.hidden-cost {
            background: rgba(139, 92, 246, 0.08);
            border: 1px dashed rgba(139, 92, 246, 0.3);
        }

        .cost-line.hidden-cost .cost-line-amount {
            color: var(--purple);
        }

        .hidden-tag {
            font-size: 0.7rem;
            background: var(--purple);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 6px;
            font-weight: 600;
        }

        .cost-line.total {
            background: var(--text);
            color: white;
            font-weight: 600;
            margin-top: 4px;
        }

        .cost-line.total .cost-line-amount {
            color: white;
            font-size: 1rem;
        }

        .cost-line-label {
            color: var(--text);
        }

        .cost-line.total .cost-line-label {
            color: white;
        }

        .cost-line-amount {
            font-weight: 600;
            color: var(--text);
        }

        .income-bar-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 6px;
        }

        .income-bar-label strong {
            color: var(--text);
        }

        .income-bar {
            height: 32px;
            background: var(--border);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .income-bar-fill {
            height: 100%;
            display: flex;
            transition: width 0.5s ease-out;
        }

        .income-bar-segment {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
            transition: width 0.5s ease-out;
        }

        .income-bar-segment.your-share {
            background: var(--red-dark);
        }

        .income-bar-segment.employer-share {
            background: var(--purple);
        }

        .income-bar-segment.oop-share {
            background: var(--red);
        }

        .income-bar-segment.remaining {
            background: var(--green);
        }

        .bar-legend {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            font-size: 0.75rem;
            margin-top: 8px;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text-light);
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }

        .legend-dot.your-share { background: var(--red-dark); }
        .legend-dot.employer-share { background: var(--purple); }
        .legend-dot.oop-share { background: var(--red); }
        .legend-dot.remaining { background: var(--green); }

        .employment-note {
            margin-top: 12px;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.2);
            color: var(--text);
        }

        .employment-note strong {
            color: var(--purple);
        }

        .employment-note.warning {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .employment-note.warning strong {
            color: var(--red);
        }

        .income-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .income-compare-box {
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .income-compare-box.current {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .income-compare-box.universal {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .income-compare-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .income-compare-box.current .income-compare-label { color: var(--red); }
        .income-compare-box.universal .income-compare-label { color: var(--green); }

        .income-compare-pct {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .income-compare-box.current .income-compare-pct { color: var(--red); }
        .income-compare-box.universal .income-compare-pct { color: var(--green); }

        .income-compare-detail {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .income-impact {
            margin-top: 16px;
            padding: 14px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .income-impact.regressive {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: var(--text);
        }

        .income-impact.regressive strong {
            color: var(--red);
        }

        .inline-source {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .inline-source a {
            color: var(--primary);
            text-decoration: none;
        }

        .inline-source a:hover {
            text-decoration: underline;
        }

        @media (max-width: 600px) {
            body {
                padding: 12px;
            }

            .cost-demo {
                padding: 20px;
            }

            .widget-header h2 {
                font-size: 1.25rem;
            }

            .income-btn {
                min-width: 70px;
                padding: 8px 6px;
                font-size: 0.75rem;
            }

            .income-btn .income-pct {
                font-size: 0.6rem;
            }

            .income-comparison {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="healthcare-widget">
        <div class="widget-header">
            <h2>Healthcare Hits Different by Income</h2>
            <p class="widget-subtitle">See how much of your earnings go to healthcare based on income and employment type</p>
        </div>

        <div class="cost-demo">
            <h4>Your Income</h4>
            <div class="income-selector" id="income-selector">
                <button class="income-btn" data-income="0">
                    $0
                    <span class="income-pct">Unemployed</span>
                </button>
                <button class="income-btn" data-income="20000">
                    $10-30K
                    <span class="income-pct">21% of US</span>
                </button>
                <button class="income-btn" data-income="40000">
                    $30-50K
                    <span class="income-pct">18% of US</span>
                </button>
                <button class="income-btn" data-income="75000">
                    $50-100K
                    <span class="income-pct">24% of US</span>
                </button>
                <button class="income-btn" data-income="175000">
                    $100-250K
                    <span class="income-pct">28% of US</span>
                </button>
                <button class="income-btn" data-income="350000">
                    $250-450K+
                    <span class="income-pct">9% of US</span>
                </button>
            </div>

            <h4 style="margin-top: 16px;">Your Employment Type</h4>
            <div class="income-selector" id="employment-selector">
                <button class="income-btn" data-employment="minimum">
                    Min. Wage
                    <span class="income-label">Retail/Service</span>
                </button>
                <button class="income-btn" data-employment="gig">
                    Gig/Contract
                    <span class="income-label">1099 Worker</span>
                </button>
                <button class="income-btn" data-employment="parttime">
                    Part-Time
                    <span class="income-label">No Benefits</span>
                </button>
                <button class="income-btn" data-employment="fulltime">
                    Full-Time
                    <span class="income-label">W-2 + Benefits</span>
                </button>
            </div>

            <h4 style="margin-top: 16px;">Your State Type</h4>
            <div class="state-selector">
                <select id="state-select">
                    <option value="expansion">Medicaid Expansion State (41 states + DC)</option>
                    <option value="non-expansion">Non-Expansion State (TX, FL, GA, etc.)</option>
                </select>
            </div>

            <div class="income-visual" style="display: none;">
                <div class="cost-breakdown-grid" id="cost-breakdown">
                    <div class="cost-breakdown-header">Annual Healthcare Costs</div>
                    <div class="cost-line hidden-cost" id="employer-row">
                        <span class="cost-line-label">Employer's Share <span class="hidden-tag">invisible to you</span></span>
                        <span class="cost-line-amount" id="cost-employer">$17,393/yr</span>
                    </div>
                    <div class="cost-line">
                        <span class="cost-line-label">Your Premium (paycheck deduction)</span>
                        <span class="cost-line-amount" id="cost-premium">$6,575/yr</span>
                    </div>
                    <div class="cost-line">
                        <span class="cost-line-label">Out-of-Pocket (deductibles, copays)</span>
                        <span class="cost-line-amount" id="cost-oop">$3,000/yr</span>
                    </div>
                    <div class="cost-line total">
                        <span class="cost-line-label">Total Healthcare Cost</span>
                        <span class="cost-line-amount" id="cost-total">$27,000/yr</span>
                    </div>
                </div>

                <div class="income-bar-label">
                    <span>Your Income: <strong id="income-amount">$75,000</strong></span>
                    <span>Total Healthcare: <strong id="healthcare-pct-label">36%</strong></span>
                </div>
                <div class="income-bar">
                    <div class="income-bar-fill">
                        <div class="income-bar-segment employer-share" id="bar-employer-share" style="width: 20%"></div>
                        <div class="income-bar-segment your-share" id="bar-your-share" style="width: 10%"></div>
                        <div class="income-bar-segment oop-share" id="bar-oop-share" style="width: 6%"></div>
                        <div class="income-bar-segment remaining" id="bar-remaining" style="width: 64%"></div>
                    </div>
                </div>
                <div class="bar-legend" id="bar-legend">
                    <span class="legend-item"><span class="legend-dot employer-share"></span> Employer's Share</span>
                    <span class="legend-item"><span class="legend-dot your-share"></span> Your Premium</span>
                    <span class="legend-item"><span class="legend-dot oop-share"></span> Out-of-Pocket</span>
                    <span class="legend-item"><span class="legend-dot remaining"></span> Remaining</span>
                </div>
                <div id="employment-note" class="employment-note" style="display: none;"></div>
            </div>

            <div class="income-comparison" style="display: none;">
                <div class="income-compare-box current">
                    <div class="income-compare-label">Current System</div>
                    <div class="income-compare-pct" id="current-pct">36%</div>
                    <div class="income-compare-detail" id="current-detail">of income to healthcare</div>
                </div>
                <div class="income-compare-box universal">
                    <div class="income-compare-label">Universal System</div>
                    <div class="income-compare-pct" id="universal-pct">8%</div>
                    <div class="income-compare-detail" id="universal-detail">income-based tax</div>
                </div>
            </div>

            <div class="income-impact regressive" id="income-impact" style="display: none;">
                <strong>The problem:</strong> A family earning $30K pays 90% of their income to healthcare (true total cost), while a family earning $200K pays only 13.5%. Same coverage, wildly unfair burden.
            </div>
            <div class="inline-source" style="margin-top: 12px; text-align: center;">
                Sources: <a href="https://www.kff.org/health-costs/report/employer-health-benefits-annual-survey/" target="_blank">KFF 2024</a> Â·
                <a href="https://www.bls.gov/cex/" target="_blank">BLS Consumer Expenditure</a>
            </div>
        </div>
    </div>

    <script>
        // DOM elements
        const employmentBtns = document.querySelectorAll('#employment-selector .income-btn');
        const incomeBtns = document.querySelectorAll('#income-selector .income-btn');
        const incomeAmount = document.getElementById('income-amount');
        const barYourShare = document.getElementById('bar-your-share');
        const barEmployerShare = document.getElementById('bar-employer-share');
        const barOopShare = document.getElementById('bar-oop-share');
        const barRemaining = document.getElementById('bar-remaining');
        const barLegend = document.getElementById('bar-legend');
        const currentPct = document.getElementById('current-pct');
        const currentDetail = document.getElementById('current-detail');
        const universalPct = document.getElementById('universal-pct');
        const universalDetail = document.getElementById('universal-detail');
        const incomeImpact = document.getElementById('income-impact');
        const employmentNote = document.getElementById('employment-note');
        const costPremium = document.getElementById('cost-premium');
        const costEmployer = document.getElementById('cost-employer');
        const costOop = document.getElementById('cost-oop');
        const costTotal = document.getElementById('cost-total');
        const employerRow = document.getElementById('employer-row');
        const healthcarePctLabel = document.getElementById('healthcare-pct-label');
        const stateSelect = document.getElementById('state-select');

        // Current state - null means nothing selected yet
        let currentEmployment = null;
        let currentIncome = null;
        let currentState = 'expansion';

        // Employment type data
        const employmentData = {
            fulltime: {
                label: 'Full-Time W-2',
                employerPays: 17393,
                employeePays: 6575,
                outOfPocket: 3000,
                totalCost: 27000,
                note: null
            },
            parttime: {
                label: 'Part-Time (No Benefits)',
                employerPays: 0,
                employeePays: 15000,
                outOfPocket: 5000,
                totalCost: 20000,
                note: '<strong>No employer help:</strong> Part-time workers must buy their own insurance on the ACA marketplace. No employer contribution means YOU pay the full cost.'
            },
            gig: {
                label: 'Gig/Contract (1099)',
                employerPays: 0,
                employeePays: 15000,
                outOfPocket: 5000,
                totalCost: 20000,
                note: '<strong>The gig economy trap:</strong> As a 1099 contractor, you\'re "your own boss" but also your own HR department. No employer contribution, no group rates, no pre-tax benefits.'
            },
            minimum: {
                label: 'Minimum Wage (Retail/Service)',
                employerPays: 0,
                employeePays: 12000,
                outOfPocket: 4000,
                totalCost: 16000,
                note: '<strong>The subsidy cliff:</strong> ACA subsidies help, but many minimum wage workers still can\'t afford coverage. In non-expansion states, they may fall in the "coverage gap" - too poor for ACA subsidies, but not eligible for Medicaid.'
            }
        };

        // Income labels
        const incomeLabels = {
            0: '$0 (Unemployed)',
            20000: '$10-30K (avg $20K)',
            40000: '$30-50K (avg $40K)',
            75000: '$50-100K (avg $75K)',
            175000: '$100-250K (avg $175K)',
            350000: '$250-450K+ (avg $350K)'
        };

        function getAdjustedCosts(employment, income, stateType) {
            const base = employmentData[employment];
            const medicaidEligible = income === 0 || (income <= 20000 && employment !== 'fulltime');

            if (stateType === 'expansion' && medicaidEligible) {
                return {
                    employerPays: 0,
                    employeePays: 0,
                    outOfPocket: 500,
                    totalCost: 500,
                    isMedicaid: true,
                    note: income === 0
                        ? '<strong>Medicaid coverage:</strong> With no income, you qualify for Medicaid in expansion states. Coverage is nearly free - just minimal copays for some services.'
                        : '<strong>Medicaid coverage:</strong> In expansion states, adults earning up to 138% of the federal poverty level ($20,783/year for an individual) qualify for Medicaid. Coverage is nearly free - just minimal copays for some services.'
                };
            } else if (stateType === 'non-expansion' && medicaidEligible) {
                return {
                    employerPays: 0,
                    employeePays: 0,
                    outOfPocket: 8000,
                    totalCost: 8000,
                    isCoverageGap: true,
                    note: income === 0
                        ? '<strong>THE COVERAGE GAP:</strong> Even with $0 income, you may not qualify for Medicaid in non-expansion states (TX, FL, GA, WI, etc.). Childless adults often have no options - forced to rely on emergency rooms or go without care entirely.'
                        : '<strong>THE COVERAGE GAP:</strong> In non-expansion states (TX, FL, GA, WI, etc.), adults without children often can\'t get Medicaid regardless of income. You\'re too poor for ACA subsidies but don\'t qualify for Medicaid. Result: uninsured, relying on emergency rooms.'
                };
            }

            return {
                employerPays: base.employerPays,
                employeePays: base.employeePays,
                outOfPocket: base.outOfPocket,
                totalCost: base.totalCost,
                isMedicaid: false,
                isCoverageGap: false,
                note: base.note
            };
        }

        function getInsight(income, employment, adjustedCosts) {
            if (income === 0) {
                if (adjustedCosts.isMedicaid) {
                    return '<strong>Medicaid safety net:</strong> With no income, you qualify for Medicaid in expansion states - comprehensive coverage with minimal costs.';
                } else if (adjustedCosts.isCoverageGap) {
                    return '<strong>No income, no coverage:</strong> In non-expansion states, having zero income doesn\'t guarantee healthcare. You may fall into the coverage gap with no affordable options.';
                }
                return '<strong>No income situation:</strong> Without income, healthcare costs represent an infinite burden. This is why safety net programs exist.';
            }

            const pct = Math.round((adjustedCosts.totalCost / income) * 100);

            if (adjustedCosts.isMedicaid) {
                return '<strong>Medicaid safety net:</strong> In expansion states, low-income workers qualify for Medicaid - nearly free comprehensive coverage. This is what the healthcare system could look like for everyone.';
            }
            if (adjustedCosts.isCoverageGap) {
                return '<strong>The coverage gap crisis:</strong> In non-expansion states, ~2.2 million Americans are trapped - earning too little for ACA subsidies, but not qualifying for Medicaid. Many go uninsured and rely on emergency rooms.';
            }

            if (employment === 'fulltime') {
                if (income <= 30000) {
                    return '<strong>Crushing burden:</strong> For the 21% of Americans in this bracket, even with employer benefits, healthcare\'s TRUE cost ($27K) could be over 100% of income. This hidden cost suppresses wages.';
                } else if (income <= 100000) {
                    return '<strong>The middle squeeze:</strong> For the 42% of Americans in this bracket, healthcare takes ' + pct + '% of income when you count the employer\'s "hidden" contribution. That money could be higher wages.';
                } else if (income <= 250000) {
                    return '<strong>Getting easier:</strong> For the 28% in this bracket, healthcare is ' + pct + '% of income - more manageable, but you get the same coverage as someone paying 100%+.';
                } else {
                    return '<strong>The unfairness:</strong> For the top 9%, healthcare is just ' + pct + '% of income. Same insurance, same coverage, but dramatically lower burden than lower-income families.';
                }
            } else if (employment === 'parttime' || employment === 'gig') {
                if (income <= 30000) {
                    return '<strong>Impossible choice:</strong> At this income with no employer benefits, healthcare costs $20K/year - that\'s ' + pct + '% of your income! Many gig workers simply go uninsured.';
                } else if (income <= 100000) {
                    return '<strong>The gig penalty:</strong> Without employer help, you\'re paying $20K for healthcare - ' + pct + '% of income. Full-time W-2 workers get $17K of hidden employer support you don\'t.';
                } else {
                    return '<strong>The self-employment tax:</strong> Even at higher incomes, lack of employer benefits means paying the FULL cost yourself. This is a hidden $17K/year penalty for not having traditional employment.';
                }
            } else {
                if (currentState === 'non-expansion') {
                    return '<strong>The coverage gap:</strong> In non-expansion states, minimum wage workers often can\'t afford coverage. You may be too poor for ACA subsidies but not qualify for Medicaid.';
                }
                return '<strong>The subsidy cliff:</strong> At minimum wage, ACA subsidies help significantly, but out-of-pocket costs can still be a burden.';
            }
        }

        function updateDisplay() {
            // Hide results section if no selections made
            const incomeVisual = document.querySelector('.income-visual');
            const incomeComparison = document.querySelector('.income-comparison');
            const incomeImpactDiv = document.getElementById('income-impact');

            if (currentIncome === null || currentEmployment === null) {
                incomeVisual.style.display = 'none';
                incomeComparison.style.display = 'none';
                incomeImpactDiv.style.display = 'none';
                return;
            }

            incomeVisual.style.display = 'block';
            incomeComparison.style.display = 'grid';
            incomeImpactDiv.style.display = 'block';

            const adjustedCosts = getAdjustedCosts(currentEmployment, currentIncome, currentState);
            const universalTax = Math.round(currentIncome * 0.08);

            let currentPctVal, universalPctVal;
            if (currentIncome === 0) {
                currentPctVal = adjustedCosts.totalCost > 0 ? Infinity : 0;
                universalPctVal = 0;
            } else {
                currentPctVal = Math.round((adjustedCosts.totalCost / currentIncome) * 100);
                universalPctVal = Math.round((universalTax / currentIncome) * 100);
            }
            const savingsAmt = adjustedCosts.totalCost - universalTax;

            // Update cost breakdown
            costPremium.textContent = '$' + adjustedCosts.employeePays.toLocaleString() + '/yr';
            costOop.textContent = '$' + adjustedCosts.outOfPocket.toLocaleString() + '/yr';
            costTotal.textContent = '$' + adjustedCosts.totalCost.toLocaleString() + '/yr';

            if (adjustedCosts.employerPays > 0) {
                employerRow.style.display = 'flex';
                costEmployer.textContent = '$' + adjustedCosts.employerPays.toLocaleString() + '/yr';
            } else {
                employerRow.style.display = 'none';
            }

            incomeAmount.textContent = incomeLabels[currentIncome];
            if (currentIncome === 0) {
                healthcarePctLabel.textContent = adjustedCosts.totalCost > 0 ? 'N/A' : '0%';
            } else {
                healthcarePctLabel.textContent = currentPctVal > 100 ? '>100%' : currentPctVal + '%';
            }

            let yourSharePct, employerSharePct, oopSharePct, totalHealthcarePct, remainingPct;
            if (currentIncome === 0) {
                yourSharePct = adjustedCosts.employeePays > 0 ? 33 : 0;
                employerSharePct = adjustedCosts.employerPays > 0 ? 34 : 0;
                oopSharePct = adjustedCosts.outOfPocket > 0 ? 33 : 0;
                totalHealthcarePct = 100;
                remainingPct = 0;
            } else {
                yourSharePct = Math.min(Math.round((adjustedCosts.employeePays / currentIncome) * 100), 100);
                employerSharePct = Math.min(Math.round((adjustedCosts.employerPays / currentIncome) * 100), 100);
                oopSharePct = Math.min(Math.round((adjustedCosts.outOfPocket / currentIncome) * 100), 100);
                totalHealthcarePct = Math.min(yourSharePct + employerSharePct + oopSharePct, 100);
                remainingPct = Math.max(100 - totalHealthcarePct, 0);
            }

            barYourShare.style.width = yourSharePct + '%';
            barOopShare.style.width = oopSharePct + '%';
            barRemaining.style.width = remainingPct + '%';

            // Change oop-share color to yellow for Medicaid coverage
            const oopLegendItem = barLegend.querySelectorAll('.legend-item')[2];
            const oopLegendDot = oopLegendItem.querySelector('.legend-dot');
            if (adjustedCosts.isMedicaid) {
                barOopShare.style.background = 'var(--yellow)';
                oopLegendDot.style.background = 'var(--yellow)';
                oopLegendItem.innerHTML = '<span class="legend-dot oop-share" style="background: var(--yellow)"></span> Medicaid Coverage';
            } else {
                barOopShare.style.background = 'var(--red)';
                oopLegendDot.style.background = 'var(--red)';
                oopLegendItem.innerHTML = '<span class="legend-dot oop-share"></span> Out-of-Pocket';
            }

            if (adjustedCosts.employerPays > 0) {
                barEmployerShare.style.width = employerSharePct + '%';
                barEmployerShare.style.display = 'block';
            } else {
                barEmployerShare.style.width = '0%';
                barEmployerShare.style.display = 'none';
            }

            const employerLegendItem = barLegend.querySelectorAll('.legend-item')[0];
            if (adjustedCosts.employerPays > 0) {
                employerLegendItem.style.display = 'flex';
            } else {
                employerLegendItem.style.display = 'none';
            }

            if (currentIncome === 0) {
                currentPct.textContent = adjustedCosts.totalCost > 0 ? 'N/A' : '$0';
                universalPct.textContent = '$0';
            } else {
                currentPct.textContent = currentPctVal + '%';
                universalPct.textContent = universalPctVal + '%';
            }
            currentDetail.textContent = '$' + adjustedCosts.totalCost.toLocaleString() + '/year';

            if (currentIncome === 0) {
                universalDetail.textContent = '$0/year (no income = no tax)';
            } else if (savingsAmt > 0) {
                universalDetail.textContent = '$' + universalTax.toLocaleString() + '/year (save $' + savingsAmt.toLocaleString() + ')';
            } else if (savingsAmt < 0) {
                universalDetail.textContent = '$' + universalTax.toLocaleString() + '/year';
            } else {
                universalDetail.textContent = '$' + universalTax.toLocaleString() + '/year (same cost)';
            }

            incomeImpact.innerHTML = getInsight(currentIncome, currentEmployment, adjustedCosts);

            const noteToShow = adjustedCosts.note;
            if (noteToShow) {
                employmentNote.innerHTML = noteToShow;
                employmentNote.style.display = 'block';
                if (adjustedCosts.isMedicaid) {
                    employmentNote.className = 'employment-note';
                } else {
                    employmentNote.className = 'employment-note warning';
                }
            } else {
                employmentNote.style.display = 'none';
            }
        }

        function updateEmploymentAvailability() {
            if (currentIncome === null) {
                // No income selected yet, disable employment
                employmentBtns.forEach(btn => {
                    btn.classList.add('disabled');
                    btn.disabled = true;
                });
            } else if (currentIncome === 0) {
                employmentBtns.forEach(btn => {
                    btn.classList.add('disabled');
                    btn.disabled = true;
                });
            } else {
                employmentBtns.forEach(btn => {
                    btn.classList.remove('disabled');
                    btn.disabled = false;
                });
            }
        }

        function updateStateAvailability() {
            // If no selections made, disable state selector
            if (currentIncome === null || currentEmployment === null) {
                stateSelect.disabled = true;
                stateSelect.style.opacity = '0.4';
                stateSelect.style.cursor = 'not-allowed';
                return;
            }

            const medicaidRelevant = currentIncome === 0 || (currentIncome <= 20000 && currentEmployment !== 'fulltime');

            if (medicaidRelevant) {
                stateSelect.disabled = false;
                stateSelect.style.opacity = '1';
                stateSelect.style.cursor = 'pointer';
            } else {
                stateSelect.disabled = true;
                stateSelect.style.opacity = '0.4';
                stateSelect.style.cursor = 'not-allowed';
            }
        }

        function updateIncomeAvailability() {
            incomeBtns.forEach(btn => {
                btn.classList.remove('disabled');
                btn.disabled = false;
            });
        }

        // Event handlers
        employmentBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                if (this.disabled) return;
                employmentBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentEmployment = this.dataset.employment;
                updateIncomeAvailability();
                updateStateAvailability();
                updateDisplay();
            });
        });

        incomeBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                if (this.disabled) return;
                incomeBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentIncome = parseInt(this.dataset.income);

                // If $0 income, auto-set employment to 'minimum' so results can display
                if (currentIncome === 0) {
                    currentEmployment = 'minimum';
                    employmentBtns.forEach(b => b.classList.remove('active'));
                }

                updateEmploymentAvailability();
                updateStateAvailability();
                updateDisplay();
            });
        });

        stateSelect.addEventListener('change', function() {
            currentState = this.value;
            updateDisplay();
        });

        // Initialize
        updateIncomeAvailability();
        updateStateAvailability();
        updateDisplay();
    </script>
</body>
</html>
